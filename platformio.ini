; PlatformIO Project Configuration File
;
; This file now contains TWO environments:
; 1. [env:waveshare_s3] for your original Waveshare board.
; 2. [env:m5stack_core2] for a standard M5Stack Core2.
; You can choose which one to build/upload in the PlatformIO sidebar.

[platformio]
default_envs = waveshare_s3

; =============================================================
; == Common Settings Shared by Both Boards
; =============================================================
[common_settings]
platform = espressif32
framework = arduino
monitor_speed = 115200
build_flags =
    -DBOARD_HAS_PSRAM
    -DLV_CONF_INCLUDE_SIMPLE
    -I src
lib_deps =
    ; LVGL and Networking libraries used by both
    lvgl/lvgl@^8.4.0
    links2004/WebSockets@^2.4.1
    bblanchon/ArduinoJson@^6.21.5
    ; WiFi and Ticker are part of the framework
    
; =============================================================
; == Environment for your Waveshare ESP32-S3 Board
; =============================================================
[env:waveshare_s3]
extends = common_settings
board = esp32-s3-devkitm-1

; --- Board-specific hardware settings ---
board_build.arduino.memory_type = qio_opi
board_build.flash_mode = qio
board_build.psram_type = opi
board_upload.flash_size = 16MB
board_upload.maximum_size = 16777216

; --- ESP32-S3 specific build flags ---
build_flags =
    ${common_settings.build_flags} ; Inherit common flags
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1

; --- Waveshare-specific hardware libraries ---
lib_deps =
    ${common_settings.lib_deps} ; Inherit common libraries
    https://github.com/yasir-shahzad/SoftI2C.git
    https://github.com/RobTillaart/TCA9554.git
    https://github.com/tamctec/gt911-arduino
    https://github.com/SolderedElectronics/Soldered-PCF85063A-RTC-Module-Arduino-Library.git
    https://github.com/fbiego/ESP32Time.git
    https://github.com/plerup/espsoftwareserial.git
    ; GFX Library is now a dependency of M5Unified, so it's best to let PlatformIO handle it if needed.

; =============================================================
; == Environment for an M5Stack Core2
; =============================================================
[env:m5stack_core2]
extends = common_settings
board = m5stack-core2

; --- M5Stack-specific hardware libraries ---
lib_deps =
    ${common_settings.lib_deps} ; Inherit common libraries
    m5stack/M5Unified@^0.1.12